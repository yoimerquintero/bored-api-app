<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bored API - Encuentra Actividades</title>
    <style>
        /* Tus estilos existentes se mantienen igual */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        .activity-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .filters-title {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            font-size: 1.5rem;
        }

        .filters-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .filter-select {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
            min-width: 200px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            background: white;
            transform: translateY(-2px);
        }

        .filter-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .filter-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .filter-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .results-title {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            font-size: 1.5rem;
        }

        .activities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .activity-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .activity-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .activity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .meta-tag {
            background: rgba(255, 255, 255, 0.3);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .no-activities {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            opacity: 0.8;
        }

        #random-activity {
            font-size: 1.4rem;
            margin: 30px 0;
            padding: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #get-activity {
            background: #ffd700;
            color: #333;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
        }

        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            min-width: 150px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .endpoints {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            opacity: 0.7;
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üéØ</div>
            <h1>Bored API</h1>
            <p class="subtitle">¬øAburrido? Encuentra actividades aleatorias para hacer</p>
        </div>

        <div class="activity-section">
            <h2>‚ú® Actividad Aleatoria</h2>
            <div id="random-activity">
                <div class="loading">Haz clic en el bot√≥n para obtener una actividad aleatoria...</div>
            </div>
            <button id="get-activity" onclick="getRandomActivity()">üé≤ ¬°Encontrar Actividad!</button>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-activities">0</div>
                    <div>Actividades en BD</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="api-calls">0</div>
                    <div>Llamadas a la API</div>
                </div>
            </div>
        </div>

        <div class="filters-section">
            <h2 class="filters-title">üîç Filtrar Actividades</h2>
            <div class="filters-container">
                <div class="filter-group">
                    <div class="filter-label">üé≠ Tipo de Actividad</div>
                    <select id="filter-type" class="filter-select">
                        <option value="all">Todos los tipos</option>
                        <option value="education">Educaci√≥n</option>
                        <option value="recreational">Recreaci√≥n</option>
                        <option value="social">Social</option>
                        <option value="diy">DIY/Hazlo t√∫ mismo</option>
                        <option value="charity">Caridad</option>
                        <option value="cooking">Cocina</option>
                        <option value="relaxation">Relajaci√≥n</option>
                        <option value="music">M√∫sica</option>
                        <option value="busywork">Tareas</option>
                    </select>
                    <button class="filter-button" onclick="getActivitiesByType()">üîé Buscar por Tipo</button>
                </div>

                <div class="filter-group">
                    <div class="filter-label">üìä Cantidad M√°xima</div>
                    <select id="filter-limit" class="filter-select">
                        <option value="5">5 actividades</option>
                        <option value="10">10 actividades</option>
                        <option value="15" selected>15 actividades (m√°ximo)</option>
                    </select>
                    <button class="filter-button" onclick="getActivitiesWithLimit()">üìà Ver Actividades</button>
                </div>

                <div class="filter-group">
                    <div class="filter-label" style="color: #ff6b6b;">‚ö†Ô∏è Peligro</div>
                    <button class="filter-button" onclick="resetActivities()" style="background: #ff6b6b;">
                        üóëÔ∏è Reiniciar Todo
                    </button>
                    <small style="font-size: 0.8em; opacity: 0.7; text-align: center;">
                        Borra todas las actividades
                    </small>
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2 class="results-title">üìã Resultados</h2>
            <div id="filter-results">
                <div class="no-activities">
                    Usa los filtros arriba para ver actividades espec√≠ficas
                </div>
            </div>
        </div>

        <div class="endpoints">
            <div class="endpoint-group">
                <h3>üîê Autenticaci√≥n</h3>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="path">/api/usuarios/registro</span>
                    <button class="test-btn" onclick="testEndpoint('POST', '/api/usuarios/registro')">Probar</button>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="path">/api/usuarios/login</span>
                    <button class="test-btn" onclick="testEndpoint('POST', '/api/usuarios/login')">Probar</button>
                </div>
            </div>

            <div class="endpoint-group">
                <h3>üéØ Actividades</h3>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="path">/api/actividades/aleatoria</span>
                    <button class="test-btn" onclick="testEndpoint('GET', '/api/actividades/aleatoria')">Probar</button>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="path">/api/actividades</span>
                    <button class="test-btn" onclick="testEndpoint('GET', '/api/actividades')">Probar</button>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="path">/api/actividades/tipos</span>
                    <button class="test-btn" onclick="testEndpoint('GET', '/api/actividades/tipos')">Probar</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Desarrollado por Yoimer Andres Martinez Quintero - Lenguaje de Programaci√≥n III</p>
            <p>üìö Proyecto Bored API - Actividades aleatorias guardadas en base de datos MySQL</p>
        </div>
    </div>

    <script>
        let apiCalls = 0;

        async function getRandomActivity() {
            const button = document.getElementById('get-activity');
            const activityDiv = document.getElementById('random-activity');
            
            button.textContent = 'üîÑ Buscando...';
            button.disabled = true;
            activityDiv.innerHTML = '<div class="loading">Buscando actividad aleatoria...</div>';
            
            try {
                const response = await fetch('/api/actividades/aleatoria');
                const data = await response.json();
                
                apiCalls++;
                document.getElementById('api-calls').textContent = apiCalls;
                
                if (data.success) {
                    const actividad = data.datos;
                    activityDiv.innerHTML = `
                        <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 15px;">
                            "${actividad.activity}"
                        </div>
                        <div class="activity-details">
                            <div class="activity-meta">
                                <span class="meta-tag">üé≠ ${actividad.type}</span>
                                <span class="meta-tag">üë• ${actividad.participants} participante${actividad.participants !== 1 ? 's' : ''}</span>
                                <span class="meta-tag">üí∞ ${(actividad.price * 100).toFixed(0)}% precio</span>
                                <span class="meta-tag">‚ôø ${(actividad.accessibility * 100).toFixed(0)}% accesibilidad</span>
                            </div>
                            ${actividad.link ? `<div style="margin-top: 15px;"><a href="${actividad.link}" target="_blank" style="color: #ffd700;">üîó Enlace relacionado</a></div>` : ''}
                            <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">
                                ${data.guardadoEnBD ? '‚úÖ Guardada en base de datos' : '‚ö†Ô∏è No se guard√≥ en BD'}
                            </div>
                        </div>
                    `;
                } else {
                    activityDiv.innerHTML = `<div style="color: #ff6b6b;">‚ùå Error: ${data.error}</div>`;
                }
            } catch (error) {
                activityDiv.innerHTML = `<div style="color: #ff6b6b;">‚ùå Error de conexi√≥n con el servidor</div>`;
                console.error('Error:', error);
            } finally {
                button.textContent = 'üé≤ ¬°Otra Actividad!';
                button.disabled = false;
                updateStats();
            }
        }

        async function getActivitiesByType() {
            const type = document.getElementById('filter-type').value;
            const button = event.target;
            const resultsDiv = document.getElementById('filter-results');
            
            button.textContent = 'Buscando...';
            button.disabled = true;
            resultsDiv.innerHTML = '<div class="loading">Buscando actividades por tipo...</div>';
            
            try {
                let url = '/api/actividades';
                if (type !== 'all') url = `/api/actividades/tipo/${type}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) displayFilteredActivities(data.datos, `Actividades de tipo: ${type}`);
                else resultsDiv.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">‚ùå Error: ${data.error}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">‚ùå Error de conexi√≥n</div>`;
                console.error('Error:', error);
            } finally {
                button.textContent = type === 'all' ? 'üîé Ver Todas' : 'üîé Buscar por Tipo';
                button.disabled = false;
            }
        }

        async function getActivitiesWithLimit() {
            const limit = document.getElementById('filter-limit').value;
            const button = event.target;
            const resultsDiv = document.getElementById('filter-results');
            
            button.textContent = 'Cargando...';
            button.disabled = true;
            resultsDiv.innerHTML = `<div class="loading">Cargando hasta ${limit} actividades...</div>`;
            
            try {
                const response = await fetch(`/api/actividades?limit=${limit}`);
                const data = await response.json();
                
                if (data.success) displayFilteredActivities(data.datos, `√öltimas ${data.datos.length} actividades`);
                else resultsDiv.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">‚ùå Error: ${data.error}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">‚ùå Error de conexi√≥n</div>`;
                console.error('Error:', error);
            } finally {
                button.textContent = 'üìà Ver Actividades';
                button.disabled = false;
            }
        }

        function displayFilteredActivities(activities, title) {
            const resultsDiv = document.getElementById('filter-results');
            
            if (!activities || activities.length === 0) {
                resultsDiv.innerHTML = `<div class="no-activities">No se encontraron actividades</div>`;
                return;
            }
            
            let html = `<h3 style="text-align: center; margin-bottom: 20px; color: #ffd700;">
                            ${title} ‚Ä¢ Total: ${activities.length}
                        </h3>
                        <div class="activities-grid">`;
            
            activities.forEach((actividad) => {
                html += `<div class="activity-card">
                            <div class="activity-name">${actividad.activity}</div>
                            <div class="activity-meta">
                                <span class="meta-tag">üé≠ ${actividad.type}</span>
                                <span class="meta-tag">üë• ${actividad.participants}</span>
                                <span class="meta-tag">üí∞ ${(actividad.price * 100).toFixed(0)}%</span>
                                <span class="meta-tag">‚ôø ${(actividad.accessibility * 100).toFixed(0)}%</span>
                            </div>
                            ${actividad.link ? `<div style="margin-top: 10px;"><a href="${actividad.link}" target="_blank" style="color: #4CAF50; font-size: 0.9em;">üîó Enlace</a></div>` : ''}
                        </div>`;
            });
            
            html += `</div>`;
            resultsDiv.innerHTML = html;
        }

        async function updateStats() {
            try {
                const response = await fetch('/api/actividades');
                const data = await response.json();
                if (data.success) document.getElementById('total-activities').textContent = data.total;
            } catch (error) {
                console.error('Error al obtener estad√≠sticas:', error);
            }
        }

        function testEndpoint(method, path) {
            if (method === 'GET') window.open(path, '_blank');
            else alert(`Para probar ${method} ${path}, usa Postman o Thunder Client`);
        }

       // Funci√≥n para reiniciar todas las actividades
async function resetActivities() {
    // Confirmaci√≥n m√°s segura
    const confirmacion = confirm(
        "‚ö†Ô∏è ADVERTENCIA CR√çTICA ‚ö†Ô∏è\n\n" +
        "¬øEst√°s completamente seguro de que quieres borrar TODAS las actividades?\n\n" +
        "‚Ä¢ Se eliminar√°n todas las actividades de la base de datos\n" +
        "‚Ä¢ Esta acci√≥n NO se puede deshacer\n" +
        "‚Ä¢ La base de datos quedar√° vac√≠a\n\n" +
        "Escribe 'BORRAR' en el siguiente campo para confirmar:"
    );
    
    if (!confirmacion) return;
    
    // Confirmaci√≥n adicional con texto
    const textoConfirmacion = prompt(
        "Para confirmar la eliminaci√≥n total, escribe BORRAR (en may√∫sculas):"
    );
    
    if (textoConfirmacion !== "BORRAR") {
        alert("Operaci√≥n cancelada. Las actividades est√°n a salvo.");
        return;
    }

    const resultsDiv = document.getElementById('filter-results');
    
    // Mostrar estado de borrado
    resultsDiv.innerHTML = `
        <div style="text-align: center; padding: 30px;">
            <div style="font-size: 2rem; margin-bottom: 15px;">üóëÔ∏è</div>
            <div class="loading" style="font-size: 1.2rem; color: #ff6b6b;">
                Eliminando todas las actividades de la base de datos...
            </div>
            <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.7;">
                Esto puede tomar unos segundos
            </div>
        </div>
    `;

    try {
        const response = await fetch('/api/actividades/reset', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            // √âxito - mostrar confirmaci√≥n detallada
            resultsDiv.innerHTML = `
                <div style="text-align: center; padding: 40px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">‚úÖ</div>
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">¬°Base de datos reiniciada exitosamente!</h3>
                    <p style="margin-bottom: 10px;"><strong>${data.message}</strong></p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 8px; display: inline-block; margin: 10px 0;">
                        <div>üìä Actividades antes: <strong>${data.countBefore}</strong></div>
                        <div>üóëÔ∏è Actividades eliminadas: <strong>${data.eliminadas}</strong></div>
                        <div>üìä Actividades despu√©s: <strong>${data.countAfter}</strong></div>
                    </div>
                    <p style="margin-top: 20px; margin-bottom: 20px;">
                        La base de datos est√° vac√≠a y lista para empezar de cero.
                    </p>
                    <div style="margin-top: 20px;">
                        <button onclick="getRandomActivity()" style="
                            background: #4CAF50; 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-size: 1rem;
                            margin: 5px;
                        ">
                            üé≤ Obtener primera actividad
                        </button>
                        <button onclick="getActivitiesWithLimit()" style="
                            background: #2196F3; 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-size: 1rem;
                            margin: 5px;
                        ">
                            üìã Ver actividades (vac√≠o)
                        </button>
                    </div>
                </div>
            `;
            
            // Actualizar todas las secciones afectadas
            updateStats();
            
            // Actualizar la secci√≥n de actividad aleatoria
            document.getElementById('random-activity').innerHTML = 
                '<div style="text-align: center; padding: 20px; color: #4CAF50;">' +
                '‚úÖ Base de datos reiniciada - ¬°Obt√©n una nueva actividad para empezar!' +
                '</div>';
                
        } else {
            // Error del servidor
            throw new Error(data.error || 'Error desconocido del servidor');
        }
    } catch (error) {
        console.error('Error al borrar actividades:', error);
        
        // Mostrar error espec√≠fico
        resultsDiv.innerHTML = `
            <div style="text-align: center; padding: 30px; background: rgba(255, 107, 107, 0.1); border-radius: 10px;">
                <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                <h3 style="color: #ff6b6b; margin-bottom: 15px;">Error al borrar actividades</h3>
                <p style="margin-bottom: 15px;">No se pudieron eliminar las actividades de la base de datos.</p>
                <div style="background: rgba(255, 255, 255, 0.2); padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9rem; margin: 15px 0;">
                    ${error.message}
                </div>
                <div style="margin-top: 20px;">
                    <button onclick="resetActivities()" style="
                        background: #ff6b6b; 
                        color: white; 
                        border: none; 
                        padding: 10px 20px; 
                        border-radius: 5px; 
                        cursor: pointer;
                        margin: 5px;
                    ">
                        üîÑ Reintentar
                    </button>
                    <button onclick="location.reload()" style="
                        background: #2196F3; 
                        color: white; 
                        border: none; 
                        padding: 10px 20px; 
                        border-radius: 5px; 
                        cursor: pointer;
                        margin: 5px;
                    ">
                        üîÉ Recargar p√°gina
                    </button>
                </div>
            </div>
        `;
    }
}
    </script>
</body>
</html>
